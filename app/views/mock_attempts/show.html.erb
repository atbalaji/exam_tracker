<div class="max-w-6xl mx-auto px-4 py-6 space-y-10">

  <!-- Header -->
  <div>
    <h1 class="text-2xl font-bold">Mock Attempt</h1>
    <p class="text-gray-600">
      <span class="font-medium"><%= @mock_attempt.exam.name %></span> ·
      <%= @mock_attempt.attempted_on %>
    </p>
  </div>

  <!-- Snapshot KPIs -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <div class="bg-gray-100 rounded p-4">
      <p class="text-sm text-gray-500">Score</p>
      <p class="text-xl font-semibold"><%= @mock_attempt.total_score %></p>
    </div>

    <div class="bg-gray-100 rounded p-4">
      <p class="text-sm text-gray-500">Accuracy</p>
      <p class="text-xl font-semibold">
        <%= number_to_percentage(@mock_attempt.accuracy, precision: 1) %>
      </p>
    </div>

    <div class="bg-gray-100 rounded p-4">
      <p class="text-sm text-gray-500">Coverage</p>
      <p class="text-xl font-semibold">
        <%= number_to_percentage(@mock_attempt.coverage, precision: 1) %>
      </p>
    </div>

    <div class="bg-gray-100 rounded p-4">
      <p class="text-sm text-gray-500">Attempted</p>
      <p class="text-xl font-semibold"><%= @mock_attempt.total_attempted %></p>
    </div>
  </div>

  <!-- Section Breakdown -->
  <div>
    <h2 class="text-xl font-semibold mb-3">Section Breakdown</h2>

    <% if @section_results.any? %>
      <div class="overflow-x-auto">
        <table class="min-w-full border bg-white">
          <thead class="bg-gray-200">
            <tr>
              <th class="px-3 py-2 text-left">Section</th>
              <th class="px-3 py-2 text-right">Attempted</th>
              <th class="px-3 py-2 text-right">Correct</th>
              <th class="px-3 py-2 text-right">Accuracy</th>
              <th class="px-3 py-2 text-right">Score</th>
            </tr>
          </thead>
          <tbody>
            <% @section_results.each do |r| %>
              <% accuracy =
                   r.attempted.zero? ? nil : (r.correct.to_f / r.attempted * 100) %>
              <tr class="border-t">
                <td class="px-3 py-2 font-medium"><%= r.section.name %></td>
                <td class="px-3 py-2 text-right"><%= r.attempted %></td>
                <td class="px-3 py-2 text-right"><%= r.correct %></td>
                <td class="px-3 py-2 text-right">
                  <%= accuracy ? number_to_percentage(accuracy, precision: 1) : "—" %>
                </td>
                <td class="px-3 py-2 text-right"><%= r.score %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-gray-500">No section results saved yet.</p>
    <% end %>
  </div>

  <!-- Exam Context -->
  <div class="border-t pt-6 space-y-8">

    <h2 class="text-xl font-semibold">
      Exam-level Performance (All Attempts)
    </h2>

    <!-- Accuracy Trend -->
    <div>
      <h3 class="font-semibold mb-2">Accuracy Trend</h3>
      <ul class="space-y-1 text-sm">
        <% @accuracy_trend.each do |point| %>
          <li class="flex justify-between max-w-sm">
            <span><%= point[:date] %></span>
            <span><%= number_to_percentage(point[:accuracy], precision: 1) %></span>
          </li>
        <% end %>
      </ul>
    </div>

    <!-- Section Trends -->
    <div>
      <h3 class="font-semibold mb-2">Section-wise Accuracy Trend</h3>

      <% @section_trends.each do |section_id, points| %>
        <% section_name = Section.find(section_id).name %>
        <div class="mb-4">
          <p class="font-medium"><%= section_name %></p>
          <ul class="text-sm space-y-1">
            <% points.each do |p| %>
              <li class="flex justify-between max-w-sm">
                <span><%= p[:date] %></span>
                <span><%= number_to_percentage(p[:accuracy], precision: 1) %></span>
              </li>
            <% end %>
          </ul>
        </div>
      <% end %>
    </div>

    <!-- Weak Sections -->
    <div>
      <h3 class="font-semibold mb-2">Weak Sections</h3>

      <% if @weak_sections.any? %>
        <ul class="space-y-1">
          <% @weak_sections.each do |ws| %>
            <li class="flex justify-between max-w-sm">
              <span class="font-medium"><%= ws[:section_name] %></span>
              <span class="text-red-600">
                <%= number_to_percentage(ws[:average_accuracy], precision: 1) %>
              </span>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p class="text-gray-500">No weak sections identified yet.</p>
      <% end %>
    </div>

  </div>

</div>
