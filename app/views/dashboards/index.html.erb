<h1 class="text-2xl font-bold mb-4">Dashboard</h1>

<!-- Exam Selector -->
<div class="mb-6">
  <label for="exam_filter" class="font-semibold">Filter by Exam:</label>
  <select id="exam_filter" class="border rounded px-2 py-1">
    <option value="">All exams</option>
    <% @exams.each do |exam| %>
      <option value="<%= exam.id %>"><%= exam.name %></option>
    <% end %>
  </select>
</div>

<!-- Overall Summary -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
  <div class="bg-gray-100 p-4 rounded shadow">
    <p class="text-gray-500">Total Mocks</p>
    <p class="text-xl font-bold"><%= @total_mocks %></p>
  </div>
  <div class="bg-gray-100 p-4 rounded shadow">
    <p class="text-gray-500">Average Score</p>
    <p class="text-xl font-bold"><%= @average_score %></p>
  </div>
  <div class="bg-gray-100 p-4 rounded shadow">
    <p class="text-gray-500">Average Accuracy</p>
    <p class="text-xl font-bold"><%= @average_accuracy %> %</p>
  </div>
</div>

<!-- Recent Mocks Table -->
<h2 class="text-xl font-semibold mb-2">Recent Mocks</h2>
<table class="min-w-full bg-white border rounded mb-6">
  <thead class="bg-gray-200">
    <tr>
      <th class="px-4 py-2 text-left">Date</th>
      <th class="px-4 py-2 text-left">Exam</th>
      <th class="px-4 py-2 text-left">Score</th>
      <th class="px-4 py-2 text-left">Accuracy</th>
    </tr>
  </thead>
  <tbody>
    <% @recent_mocks.each do |m| %>
      <tr>
        <td class="border px-4 py-2"><%= m[:attempted_on] %></td>
        <td class="border px-4 py-2"><%= m[:exam_name] %></td>
        <td class="border px-4 py-2"><%= m[:score] %></td>
        <td class="border px-4 py-2"><%= m[:accuracy] %> %</td>
      </tr>
    <% end %>
  </tbody>
</table>

<!-- Weak Sections Table -->
<h2 class="text-xl font-semibold mb-2">Weak Sections</h2>
<table class="min-w-full bg-white border rounded mb-6">
  <thead class="bg-gray-200">
    <tr>
      <th class="px-4 py-2 text-left">Section</th>
      <th class="px-4 py-2 text-left">Average Accuracy</th>
      <th class="px-4 py-2 text-left">Average Coverage</th>
    </tr>
  </thead>
  <tbody>
    <% @weak_sections.each do |ws| %>
      <tr>
        <td class="border px-4 py-2"><%= ws[:section_name] %></td>
        <td class="border px-4 py-2"><%= ws[:avg_accuracy] %> %</td>
        <td class="border px-4 py-2"><%= ws[:avg_coverage] %> %</td>
      </tr>
    <% end %>
  </tbody>
</table>

<!-- Skipped / Under-Attempted Sections -->
<h2 class="text-xl font-semibold mb-2">Skipped / Under-Attempted Sections</h2>
<ul class="list-disc pl-5">
  <% @skipped_sections.each do |s| %>
    <li><%= s[:section_name] %> â€” skipped <%= s[:skipped_count] %> times</li>
  <% end %>
</ul>

<!-- LocalStorage Script for Exam Filter -->
<script>
  const examSelect = document.getElementById("exam_filter");
  // Restore last selected
  if(localStorage.getItem("dashboard_exam_filter")) {
    examSelect.value = localStorage.getItem("dashboard_exam_filter");
  }

  examSelect.addEventListener("change", () => {
    localStorage.setItem("dashboard_exam_filter", examSelect.value);
    // Optional: reload page to apply filter
    location.reload();
  });
</script>
